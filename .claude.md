# Claude Code Instructions for Learn Like Magic

> **Project:** Learn Like Magic - Adaptive Tutoring System
> **Stack:** FastAPI + LangGraph (Backend) | React + Vite (Frontend) | AWS Infrastructure
> **Last Updated:** October 23, 2025

## Project Overview

Learn Like Magic is an AI-powered adaptive tutoring system that uses LangGraph to provide personalized learning experiences. The system analyzes student responses, adapts teaching strategies, and provides targeted feedback.

## Documentation Structure

All project documentation is located in the `docs/` folder:

```
docs/
â”œâ”€â”€ deployment.md      # Infrastructure setup, deployment process, troubleshooting
â””â”€â”€ dev-workflow.md    # Daily development workflows, best practices, testing
```

### Documentation Update Policy

**ğŸ”´ CRITICAL: Always update relevant documentation when making changes**

When you make changes, update the corresponding documentation:

| Change Type | Update Document | Section |
|-------------|----------------|---------|
| Infrastructure (Terraform, AWS) | `docs/deployment.md` | Infrastructure Components, Deployment Process |
| API endpoints, database schema | `docs/deployment.md` + `docs/dev-workflow.md` | Making Changes |
| GitHub Actions workflows | `docs/dev-workflow.md` | Deployment section |
| Local development setup | `docs/dev-workflow.md` | Development Environment Setup |
| Troubleshooting solutions | Both documents | Troubleshooting sections |
| Build process (Makefile, Docker) | `docs/dev-workflow.md` | Making Changes â†’ Backend |
| Environment variables | `docs/deployment.md` | Infrastructure Components |

### Before You Commit

- [ ] Code changes made
- [ ] Tests pass (if applicable)
- [ ] Relevant documentation updated
- [ ] Commit message describes WHAT and WHY

## Architecture Overview

### Backend (`llm-backend/`)
- **Framework:** FastAPI + Uvicorn
- **AI/LLM:** LangGraph + OpenAI
- **Database:** PostgreSQL (SQLAlchemy ORM)
- **Deployment:** AWS App Runner (Docker containers)
- **Architecture:** AMD64/x86_64 âš ï¸ **CRITICAL - See below**

### Frontend (`llm-frontend/`)
- **Framework:** React + TypeScript
- **Build Tool:** Vite
- **Deployment:** S3 + CloudFront

### Infrastructure (`infra/terraform/`)
- **IaC:** Terraform
- **Cloud:** AWS (us-east-1)
- **Components:** App Runner, RDS Aurora, ECR, S3, CloudFront, Secrets Manager

## Critical Constraints

### ğŸš¨ Docker Architecture Requirement

**ALWAYS build backend Docker images for AMD64 architecture:**

```bash
# âœ… CORRECT (Production)
docker buildx build --platform linux/amd64 -t image:tag .

# âŒ WRONG (Builds for native arch - ARM64 on Mac M-series)
docker build -t image:tag .
```

**Why:** AWS App Runner runs on AMD64. ARM64 images fail silently with no logs.

**How to ensure:**
- Use `make build-prod` in `llm-backend/` (not `docker build`)
- GitHub Actions workflow uses `--platform linux/amd64` flag
- Always verify: `docker inspect IMAGE --format='{{.Architecture}}'` â†’ Must be `amd64`

### ğŸ” Security

**Never commit:**
- `.env` files
- API keys (use AWS Secrets Manager)
- Database passwords
- Private keys (`.pem`, `.key`)

**Configuration validation:**
- Required configs validated at runtime (not import time)
- See `llm-backend/config.py` and `llm-backend/main.py` startup event

## File Structure

```
learnlikemagic/
â”œâ”€â”€ .claude.md                    # â† You are here (AI assistant instructions)
â”œâ”€â”€ docs/                         # â† Documentation (KEEP UPDATED!)
â”‚   â”œâ”€â”€ deployment.md            # Infrastructure & deployment
â”‚   â””â”€â”€ dev-workflow.md          # Development workflows
â”œâ”€â”€ llm-backend/                 # FastAPI backend
â”‚   â”œâ”€â”€ main.py                  # API entry point
â”‚   â”œâ”€â”€ models.py                # Pydantic models
â”‚   â”œâ”€â”€ config.py                # Settings (runtime validation)
â”‚   â”œâ”€â”€ database.py              # DB manager
â”‚   â”œâ”€â”€ graph/                   # LangGraph implementation
â”‚   â”œâ”€â”€ Dockerfile               # Container definition
â”‚   â”œâ”€â”€ Makefile                 # Build automation â­
â”‚   â””â”€â”€ requirements.txt         # Python dependencies
â”œâ”€â”€ llm-frontend/                # React frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ infra/terraform/             # Infrastructure as Code
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ Makefile                 # Terraform automation â­
â”‚   â””â”€â”€ terraform.tfvars         # Config (gitignored)
â”œâ”€â”€ scripts/                     # Helper scripts
â”‚   â””â”€â”€ set-github-secrets.sh   # GitHub secrets setup
â””â”€â”€ .github/workflows/           # CI/CD pipelines
    â”œâ”€â”€ deploy-backend.yml       # Backend deployment
    â””â”€â”€ deploy-frontend.yml      # Frontend deployment
```

## Common Tasks

### 1. Adding a New API Endpoint

```bash
# 1. Define model in llm-backend/models.py
# 2. Add endpoint in llm-backend/main.py
# 3. Test locally: uvicorn main:app --reload
# 4. Update docs/dev-workflow.md â†’ "Adding a New API Endpoint" example
# 5. Commit & push (triggers auto-deployment)
```

### 2. Modifying Database Schema

```bash
# 1. Update model in llm-backend/db.py
# 2. Create migration function
# 3. Test migration locally
# 4. Run migration in production (manual step - see docs/deployment.md)
# 5. Update docs/deployment.md â†’ "Database Management" section
# 6. Commit & push
```

### 3. Updating Infrastructure

```bash
# 1. Modify Terraform files in infra/terraform/
# 2. Run: make plan (review changes)
# 3. Run: make apply (deploy changes)
# 4. Update docs/deployment.md â†’ "Infrastructure Components" section
# 5. Update GitHub secrets if outputs changed: ./scripts/set-github-secrets.sh
# 6. Commit & push
```

### 4. Fixing Deployment Issues

**First steps:**
1. Check GitHub Actions logs: https://github.com/manishjain-py/learnlikemagic/actions
2. Check App Runner logs: `aws logs tail /aws/apprunner/.../service`
3. Consult `docs/deployment.md` â†’ "Troubleshooting" section
4. Verify architecture: `docker inspect IMAGE --format='{{.Architecture}}'`

**If you find a new issue/solution:**
- Document it in `docs/deployment.md` and/or `docs/dev-workflow.md`
- Add to appropriate "Troubleshooting" section
- Include symptoms, causes, and solutions

## Development Workflow

### Local Development

```bash
# Backend
cd llm-backend
make run  # Starts with auto-reload

# Frontend
cd llm-frontend
npm run dev  # Starts with hot reload
```

### Deployment

**Automatic (preferred):**
- Push to `main` branch
- GitHub Actions handles deployment
- Backend triggers on: `llm-backend/**` changes
- Frontend triggers on: `llm-frontend/**` changes

**Manual (if needed):**
```bash
# Backend
cd llm-backend
make deploy  # Build AMD64 â†’ Push ECR â†’ Trigger App Runner

# Or via GitHub UI:
# https://github.com/manishjain-py/learnlikemagic/actions
# â†’ Select workflow â†’ "Run workflow"
```

## Environment Configuration

### Required GitHub Secrets

Set at: https://github.com/manishjain-py/learnlikemagic/settings/secrets/actions

```
AWS_REGION                  = us-east-1
AWS_ROLE_ARN               = arn:aws:iam::926211191776:role/...
ECR_REGISTRY               = 926211191776.dkr.ecr.us-east-1.amazonaws.com
ECR_REPOSITORY             = learnlikemagic-backend-production
APP_RUNNER_SERVICE_ARN     = arn:aws:apprunner:us-east-1:926211191776:service/...
FRONTEND_BUCKET            = learnlikemagic-frontend-production
CLOUDFRONT_DISTRIBUTION_ID = E19EYV4ZGTL1L9
VITE_API_URL              = https://ypwbjbcmbd.us-east-1.awsapprunner.com
```

**To update:** Run `./scripts/set-github-secrets.sh` after Terraform changes

### Production URLs

- **Backend API:** https://ypwbjbcmbd.us-east-1.awsapprunner.com
- **Frontend:** https://dlayb9nj2goz.cloudfront.net
- **API Docs:** https://ypwbjbcmbd.us-east-1.awsapprunner.com/docs

## Testing Checklist

Before merging to `main`:

- [ ] Code passes local tests
- [ ] Backend: `curl http://localhost:8000/` returns `{"status":"ok"}`
- [ ] Backend: `curl http://localhost:8000/health/db` connects to database
- [ ] Frontend: Loads without console errors
- [ ] No hardcoded secrets in code
- [ ] Documentation updated (if applicable)
- [ ] Architecture is AMD64 (if Docker changes)

## Troubleshooting Quick Reference

| Issue | First Check | Documentation |
|-------|-------------|---------------|
| Deployment fails | GitHub Actions logs â†’ Architecture | `docs/deployment.md` â†’ Troubleshooting #1 |
| Health check fails | CloudWatch logs â†’ Environment vars | `docs/deployment.md` â†’ Troubleshooting #1 |
| No logs in CloudWatch | Container not starting â†’ Architecture! | `docs/deployment.md` â†’ Troubleshooting #2 |
| GitHub workflow doesn't trigger | Path filter in `.github/workflows/` | `docs/dev-workflow.md` â†’ Troubleshooting #4 |
| Local backend won't start | .env file â†’ Dependencies â†’ Python version | `docs/dev-workflow.md` â†’ Troubleshooting #1 |
| Frontend API errors | VITE_API_URL â†’ CORS â†’ Backend running | `docs/dev-workflow.md` â†’ Troubleshooting #2 |

## Making Changes with Claude

### When Modifying Code

1. **Understand the change:** Read relevant docs first
2. **Make changes:** Follow patterns in existing code
3. **Test locally:** Run dev servers, verify functionality
4. **Update docs:** Add to appropriate doc file
5. **Commit properly:** Descriptive message with context

### When Troubleshooting

1. **Check docs first:** Look in `docs/deployment.md` or `docs/dev-workflow.md`
2. **Check logs:** GitHub Actions, CloudWatch, browser console
3. **Verify basics:** Architecture (AMD64), env vars, services running
4. **Document solution:** Add to troubleshooting section if new issue
5. **Update docs:** Keep solutions current

### When Adding Features

1. **Plan the change:** Which files need updates?
2. **Check dependencies:** New packages? Update requirements.txt/package.json
3. **Update models:** Pydantic models for validation
4. **Add tests:** Unit tests for backend, component tests for frontend
5. **Update docs:** Add examples to dev-workflow.md
6. **Deployment considerations:** New env vars? Database changes? Update deployment.md

## Best Practices for Claude

### DO:
âœ… Always read `docs/deployment.md` and `docs/dev-workflow.md` before major changes
âœ… Update documentation when making changes
âœ… Build Docker images with `make build-prod` (ensures AMD64)
âœ… Verify architecture before pushing: `docker inspect IMAGE --format='{{.Architecture}}'`
âœ… Use descriptive commit messages explaining WHY
âœ… Follow existing code patterns and structure
âœ… Add to troubleshooting sections when solving new issues

### DON'T:
âŒ Use `docker build` directly for production (use `make build-prod`)
âŒ Commit without updating relevant documentation
âŒ Hardcode secrets or API keys
âŒ Skip the architecture check for Docker images
âŒ Make breaking changes without updating deployment docs
âŒ Ignore path filters in GitHub Actions workflows
âŒ Forget to validate changes locally before committing

## Quick Links

- **GitHub Repository:** https://github.com/manishjain-py/learnlikemagic
- **GitHub Actions:** https://github.com/manishjain-py/learnlikemagic/actions
- **AWS Console:** https://us-east-1.console.aws.amazon.com/
- **Terraform State:** `infra/terraform/terraform.tfstate`

## Contact & Support

For issues:
1. Check documentation in `docs/`
2. Check GitHub Actions logs
3. Check AWS CloudWatch logs
4. Review this file for common patterns

---

**Remember:** This project has comprehensive documentation in `docs/`. Always consult and update it when making changes. The docs are your source of truth!

**Last Updated:** October 23, 2025
**Version:** 1.0
